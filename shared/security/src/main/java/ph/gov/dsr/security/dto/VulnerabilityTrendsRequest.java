package ph.gov.dsr.security.dto;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.time.LocalDateTime;

/**
 * Request DTO for vulnerability trends analysis
 * 
 * @author DSR Development Team
 * @version 3.0.0
 * @since 2024-12-28
 */
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class VulnerabilityTrendsRequest {

    private LocalDateTime startDate;
    private LocalDateTime endDate;
    private String groupBy; // DAY, WEEK, MONTH
    private String filterBySeverity;
    private String filterByType;
    private String filterByStatus;
    private String filterByTarget;
    private Boolean includeResolved;
    private Boolean includeFalsePositives;
    private String aggregationType; // COUNT, AVERAGE, PERCENTAGE
    private String comparisonPeriod; // PREVIOUS_PERIOD, SAME_PERIOD_LAST_YEAR
    private Integer limit;
    private String sortBy;
    private String sortOrder; // ASC, DESC
    
    /**
     * Validate the request
     */
    public boolean isValid() {
        return startDate != null && endDate != null && startDate.isBefore(endDate);
    }
    
    /**
     * Get effective group by (default to DAY if not specified)
     */
    public String getEffectiveGroupBy() {
        return groupBy != null ? groupBy : "DAY";
    }
    
    /**
     * Get effective aggregation type (default to COUNT if not specified)
     */
    public String getEffectiveAggregationType() {
        return aggregationType != null ? aggregationType : "COUNT";
    }
    
    /**
     * Get effective limit (default to 100 if not specified)
     */
    public int getEffectiveLimit() {
        return limit != null ? limit : 100;
    }
    
    /**
     * Get effective sort order (default to DESC if not specified)
     */
    public String getEffectiveSortOrder() {
        return sortOrder != null ? sortOrder : "DESC";
    }
    
    /**
     * Check if filtering is applied
     */
    public boolean hasFilters() {
        return filterBySeverity != null || filterByType != null || 
               filterByStatus != null || filterByTarget != null;
    }
}
