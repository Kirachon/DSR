<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MockDeduplicationServiceImpl.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">DSR Data Management Service</a> &gt; <a href="index.source.html" class="el_package">ph.gov.dsr.datamanagement.service.impl</a> &gt; <span class="el_source">MockDeduplicationServiceImpl.java</span></div><h1>MockDeduplicationServiceImpl.java</h1><pre class="source lang-java linenums">package ph.gov.dsr.datamanagement.service.impl;

import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;
import ph.gov.dsr.datamanagement.dto.DeduplicationRequest;
import ph.gov.dsr.datamanagement.dto.DeduplicationResponse;
import ph.gov.dsr.datamanagement.service.DeduplicationService;

import java.time.LocalDateTime;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.UUID;

/**
 * Mock implementation of DeduplicationService for no-database mode
 * 
 * @author DSR Development Team
 * @version 3.0.0
 * @since 2024-12-23
 */
@Service
<span class="nc" id="L24">@Slf4j</span>
<span class="nc" id="L25">public class MockDeduplicationServiceImpl implements DeduplicationService {</span>

    @Override
    public DeduplicationResponse findDuplicates(DeduplicationRequest request) {
<span class="nc" id="L29">        log.info(&quot;Mock finding duplicates for entity type: {}&quot;, request.getEntityType());</span>
        
<span class="nc" id="L31">        DeduplicationResponse response = new DeduplicationResponse();</span>
<span class="nc" id="L32">        response.setHasDuplicates(false); // Mock: no duplicates found</span>
<span class="nc" id="L33">        response.setTotalMatches(0);</span>
<span class="nc" id="L34">        response.setProcessedAt(LocalDateTime.now());</span>
<span class="nc" id="L35">        response.setMatches(new ArrayList&lt;&gt;());</span>
<span class="nc" id="L36">        response.setRecommendation(&quot;PROCEED&quot;);</span>
<span class="nc" id="L37">        response.setProcessingTimeMs(200L);</span>
        
        // Occasionally return a potential duplicate for demonstration
<span class="nc bnc" id="L40" title="All 2 branches missed.">        if (request.getEntityData().containsKey(&quot;firstName&quot;) &amp;&amp; </span>
<span class="nc bnc" id="L41" title="All 2 branches missed.">            &quot;JUAN&quot;.equals(request.getEntityData().get(&quot;firstName&quot;))) {</span>
            
<span class="nc" id="L43">            response.setHasDuplicates(true);</span>
<span class="nc" id="L44">            response.setTotalMatches(1);</span>
<span class="nc" id="L45">            response.setRecommendation(&quot;REVIEW_REQUIRED&quot;);</span>
            
<span class="nc" id="L47">            DeduplicationResponse.DuplicateMatch match = new DeduplicationResponse.DuplicateMatch();</span>
<span class="nc" id="L48">            match.setExistingEntityId(UUID.randomUUID());</span>
<span class="nc" id="L49">            match.setSimilarityScore(0.85);</span>
<span class="nc" id="L50">            match.setMatchType(&quot;FUZZY&quot;);</span>
            
<span class="nc" id="L52">            DeduplicationResponse.FieldMatch fieldMatch = new DeduplicationResponse.FieldMatch();</span>
<span class="nc" id="L53">            fieldMatch.setFieldName(&quot;firstName&quot;);</span>
<span class="nc" id="L54">            fieldMatch.setNewValue(&quot;JUAN&quot;);</span>
<span class="nc" id="L55">            fieldMatch.setExistingValue(&quot;JUAN CARLOS&quot;);</span>
<span class="nc" id="L56">            fieldMatch.setFieldSimilarity(0.8);</span>
<span class="nc" id="L57">            fieldMatch.setMatchReason(&quot;Partial name match&quot;);</span>
            
<span class="nc" id="L59">            match.setFieldMatches(List.of(fieldMatch));</span>
            
<span class="nc" id="L61">            Map&lt;String, Object&gt; existingData = new HashMap&lt;&gt;();</span>
<span class="nc" id="L62">            existingData.put(&quot;firstName&quot;, &quot;JUAN CARLOS&quot;);</span>
<span class="nc" id="L63">            existingData.put(&quot;lastName&quot;, &quot;DELA CRUZ&quot;);</span>
<span class="nc" id="L64">            existingData.put(&quot;psn&quot;, &quot;1234-5678-9012&quot;);</span>
<span class="nc" id="L65">            match.setExistingEntityData(existingData);</span>
            
<span class="nc" id="L67">            response.setMatches(List.of(match));</span>
        }
        
<span class="nc" id="L70">        return response;</span>
    }

    @Override
    public boolean isDuplicate(String entityType, Map&lt;String, Object&gt; entityData, double threshold) {
<span class="nc" id="L75">        log.info(&quot;Mock checking if entity is duplicate for type: {}&quot;, entityType);</span>
        
        // Mock logic: return true if firstName is &quot;DUPLICATE&quot;
<span class="nc" id="L78">        return &quot;DUPLICATE&quot;.equals(entityData.get(&quot;firstName&quot;));</span>
    }

    @Override
    public void mergeDuplicates(UUID primaryEntityId, UUID duplicateEntityId, String entityType) {
<span class="nc" id="L83">        log.info(&quot;Mock merging duplicates: {} &lt;- {} for type: {}&quot;, </span>
                primaryEntityId, duplicateEntityId, entityType);
        // Mock implementation - would perform actual merge in real implementation
<span class="nc" id="L86">    }</span>

    @Override
    public void markAsNotDuplicates(UUID entityId1, UUID entityId2, String entityType) {
<span class="nc" id="L90">        log.info(&quot;Mock marking entities as not duplicates: {} and {} for type: {}&quot;, </span>
                entityId1, entityId2, entityType);
        // Mock implementation - would store in database in real implementation
<span class="nc" id="L93">    }</span>

    @Override
    public Map&lt;String, Object&gt; getDeduplicationStatistics() {
<span class="nc" id="L97">        log.info(&quot;Mock getting deduplication statistics&quot;);</span>
        
<span class="nc" id="L99">        Map&lt;String, Object&gt; stats = new HashMap&lt;&gt;();</span>
<span class="nc" id="L100">        stats.put(&quot;totalDuplicatesFound&quot;, 150);</span>
<span class="nc" id="L101">        stats.put(&quot;duplicatesResolved&quot;, 120);</span>
<span class="nc" id="L102">        stats.put(&quot;duplicatesPending&quot;, 30);</span>
<span class="nc" id="L103">        stats.put(&quot;averageProcessingTimeMs&quot;, 250);</span>
<span class="nc" id="L104">        stats.put(&quot;lastProcessedAt&quot;, LocalDateTime.now().minusHours(2));</span>
        
<span class="nc" id="L106">        return stats;</span>
    }

    @Override
    public void configureMatchingAlgorithm(String algorithm, Map&lt;String, Object&gt; parameters) {
<span class="nc" id="L111">        log.info(&quot;Mock configuring matching algorithm: {} with parameters: {}&quot;, algorithm, parameters);</span>
        // Mock implementation - would store configuration in real implementation
<span class="nc" id="L113">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>