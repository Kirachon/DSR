<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DataIngestionBatch.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">DSR Data Management Service</a> &gt; <a href="index.source.html" class="el_package">ph.gov.dsr.datamanagement.entity</a> &gt; <span class="el_source">DataIngestionBatch.java</span></div><h1>DataIngestionBatch.java</h1><pre class="source lang-java linenums">package ph.gov.dsr.datamanagement.entity;

import jakarta.persistence.*;
import jakarta.validation.constraints.NotBlank;
import jakarta.validation.constraints.NotNull;
import lombok.Data;
import lombok.EqualsAndHashCode;
import org.springframework.data.annotation.CreatedDate;
import org.springframework.data.annotation.LastModifiedDate;
import org.springframework.data.jpa.domain.support.AuditingEntityListener;

import java.time.LocalDateTime;
import java.util.UUID;

/**
 * Entity representing a data ingestion batch operation
 * 
 * @author DSR Development Team
 * @version 3.0.0
 * @since 2024-12-23
 */
@Entity
@Table(name = &quot;data_ingestion_batches&quot;, schema = &quot;dsr_core&quot;)
@EntityListeners(AuditingEntityListener.class)
<span class="pc" id="L25">@Data</span>
<span class="nc bnc" id="L26" title="All 174 branches missed.">@EqualsAndHashCode(callSuper = false)</span>
public class DataIngestionBatch {

    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    @Column(name = &quot;id&quot;, columnDefinition = &quot;UUID&quot;)
<span class="nc" id="L32">    private UUID id;</span>

    @NotBlank
    @Column(name = &quot;batch_id&quot;, unique = true, nullable = false, length = 100)
<span class="fc" id="L36">    private String batchId;</span>

    @NotBlank
    @Column(name = &quot;source_system&quot;, nullable = false, length = 50)
<span class="nc" id="L40">    private String sourceSystem; // LISTAHANAN, I_REGISTRO, MANUAL_ENTRY</span>

    @NotBlank
    @Column(name = &quot;data_type&quot;, nullable = false, length = 50)
<span class="nc" id="L44">    private String dataType; // HOUSEHOLD, INDIVIDUAL, ECONOMIC_PROFILE</span>

    @NotBlank
    @Column(name = &quot;status&quot;, nullable = false, length = 20)
<span class="fc" id="L48">    private String status; // PROCESSING, SUCCESS, FAILED, PARTIAL</span>

<span class="fc" id="L50">    @Column(name = &quot;total_records&quot;)</span>
<span class="fc" id="L51">    private Integer totalRecords = 0;</span>

<span class="fc" id="L53">    @Column(name = &quot;successful_records&quot;)</span>
<span class="fc" id="L54">    private Integer successfulRecords = 0;</span>

<span class="fc" id="L56">    @Column(name = &quot;failed_records&quot;)</span>
<span class="fc" id="L57">    private Integer failedRecords = 0;</span>

<span class="fc" id="L59">    @Column(name = &quot;duplicate_records&quot;)</span>
<span class="fc" id="L60">    private Integer duplicateRecords = 0;</span>

    @Column(name = &quot;processing_time_ms&quot;)
<span class="fc" id="L63">    private Long processingTimeMs;</span>

    @Column(name = &quot;file_path&quot;, length = 500)
<span class="nc" id="L66">    private String filePath;</span>

    @Column(name = &quot;file_size_bytes&quot;)
<span class="nc" id="L69">    private Long fileSizeBytes;</span>

    @Column(name = &quot;submitted_by&quot;, length = 100)
<span class="nc" id="L72">    private String submittedBy;</span>

<span class="fc" id="L74">    @Column(name = &quot;processing_priority&quot;, length = 10)</span>
<span class="nc" id="L75">    private String processingPriority = &quot;NORMAL&quot;; // HIGH, NORMAL, LOW</span>

    @Column(name = &quot;error_message&quot;, columnDefinition = &quot;TEXT&quot;)
<span class="fc" id="L78">    private String errorMessage;</span>

    @Column(name = &quot;warnings&quot;, columnDefinition = &quot;TEXT&quot;)
<span class="nc" id="L81">    private String warnings;</span>

    @Column(name = &quot;metadata&quot;, columnDefinition = &quot;JSONB&quot;)
<span class="nc" id="L84">    private String metadata;</span>

    @NotNull
    @CreatedDate
    @Column(name = &quot;created_at&quot;, nullable = false)
<span class="nc" id="L89">    private LocalDateTime createdAt;</span>

    @LastModifiedDate
    @Column(name = &quot;updated_at&quot;)
<span class="nc" id="L93">    private LocalDateTime updatedAt;</span>

    @Column(name = &quot;started_at&quot;)
<span class="nc" id="L96">    private LocalDateTime startedAt;</span>

    @Column(name = &quot;completed_at&quot;)
<span class="fc" id="L99">    private LocalDateTime completedAt;</span>

    /**
     * Mark batch as started
     */
    public void markAsStarted() {
<span class="fc" id="L105">        this.status = &quot;PROCESSING&quot;;</span>
<span class="fc" id="L106">        this.startedAt = LocalDateTime.now();</span>
<span class="fc" id="L107">    }</span>

    /**
     * Mark batch as completed with success
     */
    public void markAsCompleted() {
<span class="nc" id="L113">        this.status = &quot;SUCCESS&quot;;</span>
<span class="nc" id="L114">        this.completedAt = LocalDateTime.now();</span>
<span class="nc" id="L115">        calculateProcessingTime();</span>
<span class="nc" id="L116">    }</span>

    /**
     * Mark batch as failed
     */
    public void markAsFailed(String errorMessage) {
<span class="nc" id="L122">        this.status = &quot;FAILED&quot;;</span>
<span class="nc" id="L123">        this.errorMessage = errorMessage;</span>
<span class="nc" id="L124">        this.completedAt = LocalDateTime.now();</span>
<span class="nc" id="L125">        calculateProcessingTime();</span>
<span class="nc" id="L126">    }</span>

    /**
     * Mark batch as partially completed
     */
    public void markAsPartial() {
<span class="nc" id="L132">        this.status = &quot;PARTIAL&quot;;</span>
<span class="nc" id="L133">        this.completedAt = LocalDateTime.now();</span>
<span class="nc" id="L134">        calculateProcessingTime();</span>
<span class="nc" id="L135">    }</span>

    /**
     * Calculate processing time
     */
    private void calculateProcessingTime() {
<span class="nc bnc" id="L141" title="All 4 branches missed.">        if (startedAt != null &amp;&amp; completedAt != null) {</span>
<span class="nc" id="L142">            this.processingTimeMs = java.time.Duration.between(startedAt, completedAt).toMillis();</span>
        }
<span class="nc" id="L144">    }</span>

    /**
     * Get success rate as percentage
     */
    public double getSuccessRate() {
<span class="nc bnc" id="L150" title="All 4 branches missed.">        if (totalRecords == null || totalRecords == 0) {</span>
<span class="nc" id="L151">            return 0.0;</span>
        }
<span class="nc bnc" id="L153" title="All 2 branches missed.">        return (double) (successfulRecords != null ? successfulRecords : 0) / totalRecords * 100.0;</span>
    }

    /**
     * Check if batch is completed
     */
    public boolean isCompleted() {
<span class="nc bnc" id="L160" title="All 6 branches missed.">        return &quot;SUCCESS&quot;.equals(status) || &quot;FAILED&quot;.equals(status) || &quot;PARTIAL&quot;.equals(status);</span>
    }

    /**
     * Check if batch is in progress
     */
    public boolean isInProgress() {
<span class="nc" id="L167">        return &quot;PROCESSING&quot;.equals(status);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>